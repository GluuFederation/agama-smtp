// Authn Techniques that rely on sending email
Flow org.gluu.agama.smtp.main
     Basepath ""
     Timeout 360 seconds
     Configs conf
     Inputs emailHint
// Create and initialize variable to receive email input
emailObj = { email: emailHint, captureLocation: conf.captureLocation, errorMessage: "" }
// Iterate x times max
max = Repeat 3 times max
     // Retrieve user email address from UI
     uiInput = RRF "main.ftlh" emailObj
     // Assign user email input to a variable
     email = uiInput.email
     // Create an instance Email Service
     emailService = Call org.gluu.agama.smtp.EmailService#getInstance 
     // Get User Details using Email Service
     userData = Call emailService getUserEntity email
     // 1. Logic to determine if user email is already registered 2. Initialize location, timezone info from UI to user-data
     emailUnknown = userData.empty
     userData.context = { location: uiInput.location, timeZone: uiInput.zone, device: uiInput.device }
     When emailUnknown is true
          // Trigger sub-routine to verify email
          emailVerificationResult = Trigger org.gluu.agama.smtp.emailVerification email false userData.context
          // Reset error message to empty after email verification
          emailObj.errorMessage = ""